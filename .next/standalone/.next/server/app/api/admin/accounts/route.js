"use strict";(()=>{var e={};e.id=599,e.ids=[599],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},98618:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>x,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{PATCH:()=>d});var n=r(49303),s=r(88716),i=r(60670),u=r(87070),o=r(90455),c=r(52663);async function d(e){try{let t=e.cookies.get("token")?.value;if(!t)return u.NextResponse.json({error:"Not authenticated"},{status:401});let r=(0,o.WX)(t);if(!r)return u.NextResponse.json({error:"Invalid token"},{status:401});let a=await c._.user.findUnique({where:{id:r.userId}});if(!a||"ADMIN"!==a.role)return u.NextResponse.json({error:"Access denied"},{status:403});let{accountId:n,newBalance:s,reason:i}=await e.json(),d=await c._.account.findUnique({where:{id:n},include:{user:!0}});if(!d)return u.NextResponse.json({error:"Account not found"},{status:404});let p=d.balance,l=s-p,m=await c._.$transaction(async e=>{let t=await e.account.update({where:{id:n},data:{balance:s}});return await e.transaction.create({data:{userId:d.userId,accountId:n,type:l>0?"DEPOSIT":"WITHDRAWAL",amount:Math.abs(l),description:`Admin adjustment: ${i||"Balance update"}`}}),await e.adminAction.create({data:{adminId:r.userId,action:"UPDATE_BALANCE",targetUserId:d.userId,details:JSON.stringify({accountId:n,oldBalance:p,newBalance:s,difference:l,reason:i})}}),t});return u.NextResponse.json({message:"Account balance updated successfully",account:m})}catch(e){return console.error("Admin update balance error:",e),u.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/accounts/route",pathname:"/api/admin/accounts",filename:"route",bundlePath:"app/api/admin/accounts/route"},resolvedPagePath:"/Users/divine/Documents/bankbroker/app/api/admin/accounts/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:f}=p,w="/api/admin/accounts/route";function x(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},90455:(e,t,r)=>{r.d(t,{So:()=>l,WX:()=>d,r4:()=>p});var a=r(98691),n=r(41482),s=r.n(n),i=r(52663);let u=process.env.JWT_SECRET||"fallback-secret";async function o(e){return a.ZP.hash(e,12)}async function c(e,t){return a.ZP.compare(e,t)}function d(e){try{return s().verify(e,u)}catch{return null}}async function p(e,t,r,a,n=0,s=0){let u=await o(r),c=await i._.user.create({data:{email:e,name:t,phone:a,password:u}});return await i._.account.createMany({data:[{userId:c.id,type:"CHECKING",balance:n},{userId:c.id,type:"SAVINGS",balance:s}]}),c}async function l(e,t){var r;let a=await i._.user.findUnique({where:{email:e},include:{accounts:!0}});if(!a||!await c(t,a.password))return null;let n=(r=a.id,s().sign({userId:r},u,{expiresIn:"7d"}));return{user:a,token:n}}},52663:(e,t,r)=>{r.d(t,{_:()=>n});let a=require("@prisma/client"),n=globalThis.prisma??new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,34],()=>r(98618));module.exports=a})();