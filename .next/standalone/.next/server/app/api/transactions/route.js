"use strict";(()=>{var e={};e.id=866,e.ids=[866],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},78745:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>w,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>x,staticGenerationAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{POST:()=>d});var n=r(49303),s=r(88716),o=r(60670),i=r(87070),u=r(90455),c=r(52663);async function d(e){try{let t=e.cookies.get("token")?.value;if(!t)return i.NextResponse.json({error:"Not authenticated"},{status:401});let r=(0,u.WX)(t);if(!r)return i.NextResponse.json({error:"Invalid token"},{status:401});let{type:a,amount:n,description:s,accountType:o="CHECKING"}=await e.json();if(!a||!n||n<=0)return i.NextResponse.json({error:"Invalid transaction data"},{status:400});let d=await c._.account.findFirst({where:{userId:r.userId,type:o}});if(!d)return i.NextResponse.json({error:"Account not found"},{status:404});if("WITHDRAWAL"===a&&d.balance<n)return i.NextResponse.json({error:"Insufficient funds"},{status:400});let p=d.balance;"DEPOSIT"===a?p+=n:"WITHDRAWAL"===a&&(p-=n);let l=await c._.$transaction(async e=>{let t=await e.transaction.create({data:{userId:r.userId,accountId:d.id,type:a,amount:n,description:s||`${a.toLowerCase()} transaction`}});return await e.account.update({where:{id:d.id},data:{balance:p}}),t});return i.NextResponse.json({message:"Transaction completed successfully",transaction:l,newBalance:p})}catch(e){return console.error("Transaction error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/transactions/route",pathname:"/api/transactions",filename:"route",bundlePath:"app/api/transactions/route"},resolvedPagePath:"/Users/divine/Documents/bankbroker/app/api/transactions/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:f,serverHooks:x}=p,m="/api/transactions/route";function w(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:f})}},90455:(e,t,r)=>{r.d(t,{So:()=>l,WX:()=>d,r4:()=>p});var a=r(98691),n=r(41482),s=r.n(n),o=r(52663);let i=process.env.JWT_SECRET||"fallback-secret";async function u(e){return a.ZP.hash(e,12)}async function c(e,t){return a.ZP.compare(e,t)}function d(e){try{return s().verify(e,i)}catch{return null}}async function p(e,t,r,a,n=0,s=0){let i=await u(r),c=await o._.user.create({data:{email:e,name:t,phone:a,password:i}});return await o._.account.createMany({data:[{userId:c.id,type:"CHECKING",balance:n},{userId:c.id,type:"SAVINGS",balance:s}]}),c}async function l(e,t){var r;let a=await o._.user.findUnique({where:{email:e},include:{accounts:!0}});if(!a||!await c(t,a.password))return null;let n=(r=a.id,s().sign({userId:r},i,{expiresIn:"7d"}));return{user:a,token:n}}},52663:(e,t,r)=>{r.d(t,{_:()=>n});let a=require("@prisma/client"),n=globalThis.prisma??new a.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,34],()=>r(78745));module.exports=a})();