"use strict";(()=>{var e={};e.id=319,e.ids=[319],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},52917:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>w,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{GET:()=>c,PATCH:()=>l});var n=r(49303),s=r(88716),i=r(60670),o=r(87070),u=r(90455),d=r(52663);async function c(e){try{let t=e.cookies.get("token")?.value;if(!t)return o.NextResponse.json({error:"Not authenticated"},{status:401});let r=(0,u.WX)(t);if(!r)return o.NextResponse.json({error:"Invalid token"},{status:401});let a=await d._.user.findUnique({where:{id:r.userId}});if(!a||"ADMIN"!==a.role)return o.NextResponse.json({error:"Access denied"},{status:403});let n=await d._.withdrawalRequest.findMany({include:{user:{select:{name:!0,email:!0}},account:!0},orderBy:{createdAt:"desc"}});return o.NextResponse.json({withdrawals:n})}catch(e){return console.error("Get withdrawals error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function l(e){try{let t=e.cookies.get("token")?.value;if(!t)return o.NextResponse.json({error:"Not authenticated"},{status:401});let r=(0,u.WX)(t);if(!r)return o.NextResponse.json({error:"Invalid token"},{status:401});let a=await d._.user.findUnique({where:{id:r.userId}});if(!a||"ADMIN"!==a.role)return o.NextResponse.json({error:"Access denied"},{status:403});let{withdrawalId:n,status:s,reason:i}=await e.json(),c=await d._.$transaction(async e=>{let t=await e.withdrawalRequest.findUnique({where:{id:n},include:{account:!0}});if(!t)throw Error("Withdrawal request not found");"COMPLETED"===s&&(await e.account.update({where:{id:t.accountId},data:{balance:{decrement:t.amount}}}),await e.transaction.create({data:{userId:t.userId,accountId:t.accountId,type:"WITHDRAWAL",amount:t.amount,description:`Bank withdrawal to ${t.bankName} - ${t.accountNumber}`}}));let a=await e.withdrawalRequest.update({where:{id:n},data:{status:s,reason:i}});return await e.adminAction.create({data:{adminId:r.userId,action:"PROCESS_WITHDRAWAL",targetUserId:t.userId,details:JSON.stringify({withdrawalId:n,status:s,reason:i,amount:t.amount})}}),a});return o.NextResponse.json({message:"Withdrawal request processed successfully",withdrawal:c})}catch(e){return console.error("Process withdrawal error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/withdrawals/route",pathname:"/api/admin/withdrawals",filename:"route",bundlePath:"app/api/admin/withdrawals/route"},resolvedPagePath:"/Users/divine/Documents/bankbroker/app/api/admin/withdrawals/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:w,staticGenerationAsyncStorage:h,serverHooks:m}=p,f="/api/admin/withdrawals/route";function x(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},90455:(e,t,r)=>{r.d(t,{So:()=>p,WX:()=>c,r4:()=>l});var a=r(98691),n=r(41482),s=r.n(n),i=r(52663);let o=process.env.JWT_SECRET||"fallback-secret";async function u(e){return a.ZP.hash(e,12)}async function d(e,t){return a.ZP.compare(e,t)}function c(e){try{return s().verify(e,o)}catch{return null}}async function l(e,t,r,a,n=0,s=0){let o=await u(r),d=await i._.user.create({data:{email:e,name:t,phone:a,password:o}});return await i._.account.createMany({data:[{userId:d.id,type:"CHECKING",balance:n},{userId:d.id,type:"SAVINGS",balance:s}]}),d}async function p(e,t){var r;let a=await i._.user.findUnique({where:{email:e},include:{accounts:!0}});if(!a||!await d(t,a.password))return null;let n=(r=a.id,s().sign({userId:r},o,{expiresIn:"7d"}));return{user:a,token:n}}},52663:(e,t,r)=>{r.d(t,{_:()=>n});let a=require("@prisma/client"),n=globalThis.prisma??new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,34],()=>r(52917));module.exports=a})();